<!-- public/index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Giftly</title>
  <style>
    :root { --bg:#fff; --fg:#0a0a0a; --muted:#6b7280; --brand:#0ea5e9; }
    body { margin:0; font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:var(--bg); color:var(--fg); }
    .app { max-width:420px; margin:0 auto; min-height:100vh; display:flex; flex-direction:column; }
    header { padding:16px 20px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #f1f5f9; }
    header h1 { font-size:18px; margin:0; }
    main { padding:16px 20px; }
    .card { border:1px solid #e5e7eb; border-radius:16px; padding:14px; margin-bottom:12px; }
    .row { display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .muted { color:var(--muted); }
    .btn { border:none; border-radius:12px; padding:10px 14px; background:var(--brand); color:#fff; cursor:pointer; }
    .tabs { position:sticky; bottom:0; left:0; right:0; border-top:1px solid #e5e7eb; background:#fff; display:grid; grid-template-columns:1fr 1fr 1fr; }
    .tab { padding:10px 8px; text-align:center; color:#334155; }
    input, select, textarea { width:100%; padding:10px 12px; border:1px solid #e5e7eb; border-radius:12px; }
    .stack { display:flex; flex-direction:column; gap:10px; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Giftly</h1>
      <span class="muted" id="status">Not logged in</span>
    </header>
    <main>
      <div class="card">
        <div class="stack">
          <div class="row"><strong>Quick test</strong><span class="muted" id="api"></span></div>
          <div class="row"><input id="email" placeholder="email" /><input id="pw" type="password" placeholder="password" /></div>
          <div class="row">
            <button class="btn" id="signup">Sign up</button>
            <button class="btn" id="login">Log in</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="stack">
          <div class="row"><strong>Gift ideas</strong><span class="muted">age / gender / budget / notes</span></div>
          <div class="row">
            <input id="age" type="number" placeholder="30" />
            <select id="gender">
              <option value="">—</option>
              <option>male</option>
              <option>female</option>
              <option>unisex</option>
            </select>
            <input id="budget" type="number" placeholder="800" />
          </div>
          <input id="notes" placeholder="coffee, outdoor, lego…" />
          <button class="btn" id="ideas">View ideas</button>
          <div id="ideasOut"></div>
        </div>
      </div>
    </main>

    <nav class="tabs">
      <div class="tab">Dashboard</div>
      <div class="tab">Add</div>
      <div class="tab">Profile</div>
    </nav>
  </div>

  <script>
    const API = location.origin;
    const s = (sel) => document.querySelector(sel);
    const statusEl = s('#status');
    const apiEl = s('#api'); apiEl.textContent = API;

    let token = '';

    async function call(path, opts={}) {
      const headers = { 'Content-Type': 'application/json' };
      if (token) headers.Authorization = 'Bearer ' + token;
      const res = await fetch(API + path, { ...opts, headers });
      const text = await res.text();
      try { return JSON.parse(text); } catch { throw new Error(text || res.statusText); }
    }

    s('#signup').onclick = async () => {
      const email = s('#email').value.trim();
      const password = s('#pw').value;
      const j = await call('/auth/signup', { method: 'POST', body: JSON.stringify({ fullName: 'Web User', email, password }) });
      token = j.token; statusEl.textContent = 'Signed up';
    };
    s('#login').onclick = async () => {
      const email = s('#email').value.trim();
      const password = s('#pw').value;
      const j = await call('/auth/login', { method: 'POST', body: JSON.stringify({ email, password }) });
      token = j.token; statusEl.textContent = 'Logged in';
    };
    s('#ideas').onclick = async () => {
      const q = new URLSearchParams({
        age: s('#age').value,
        gender: s('#gender').value,
        budget: s('#budget').value,
        notes: s('#notes').value,
      }).toString();
      const j = await call('/ideas?' + q);
      const out = (j.ideas || []).map(it => `
        <div class="card">
          <div class="row"><strong>${it.name}</strong><span class="muted">${Math.round(it.price_nok||0)} NOK</span></div>
          ${it.image_url ? `<img src="${it.image_url}" style="width:100%;border-radius:12px;margin-top:8px">` : ''}
          ${it.description ? `<div class="muted" style="margin-top:8px">${it.description}</div>` : ''}
        </div>
      `).join('') || '<div class="muted">No ideas yet.</div>';
      s('#ideasOut').innerHTML = out;
    };
  </script>
</body>
</html>
