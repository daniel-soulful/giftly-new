<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Giftify</title>
  <style>
    :root {
      --bg: #fff;
      --fg: #0b1220;
      --muted: #6b7280;
      --line: #e5e7eb;
      --card: #ffffff;
      --brand: #0ea5e9;      /* sky-500 */
      --brand-ink: #0369a1;  /* sky-700 */
      --shadow: 0 4px 20px rgba(2, 6, 23, 0.06);
      --radius: 18px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font: 16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* App shell */
    .app { max-width: 430px; margin: 0 auto; min-height: 100dvh; display: grid; grid-template-rows: auto 1fr auto; }
    header {
      position: sticky; top: 0; z-index: 10;
      display: flex; align-items: center; gap: 12px;
      padding: 14px 16px; background: var(--bg); border-bottom: 1px solid var(--line);
    }
    .brand { color: var(--brand); font-weight: 800; letter-spacing: .2px; }
    .back { width: 28px; height: 28px; border-radius: 999px; display: grid; place-items: center; cursor: pointer; }
    .back::before { content: "‚Üê"; font-weight: 700; color: var(--brand-ink); }

    main { padding: 14px 14px 88px; }
    .section-title { font-weight: 800; margin: 8px 2px 12px; font-size: 18px; }
    .muted { color: var(--muted); }

    /* Cards & inputs */
    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 12px;
      margin: 10px 2px;
    }
    .row { display: flex; gap: 10px; align-items: center; }
    .stack { display: grid; gap: 10px; }

    input, select, textarea {
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 10px 12px;
      font: inherit;
      background: #fff;
    }
    button.btn {
      appearance: none; border: none;
      background: var(--brand); color: #fff; font-weight: 700;
      padding: 11px 14px; border-radius: 14px; cursor: pointer;
      box-shadow: 0 6px 16px rgba(14,165,233,0.25);
    }
    .btn.secondary { background: #f1f5f9; color: #0f172a; box-shadow: none; }

    /* Product card with square image */
    .idea-card { padding: 12px; }
    .idea-img {
      width: 100%; aspect-ratio: 1/1; border-radius: 14px; overflow: hidden;
      background: #f8fafc; border: 1px solid var(--line); display: block;
    }
    .idea-img > img { width: 100%; height: 100%; object-fit: cover; display: block; }

    .idea-title { font-weight: 800; margin: 10px 2px 4px; }
    .idea-meta { display: flex; justify-content: space-between; color: var(--muted); font-size: 14px; }
    .idea-desc { color: var(--fg); opacity: .9; margin-top: 6px; }

    /* Tabs */
    nav.tabs {
      position: sticky; bottom: 0; left: 0; right: 0;
      display: grid; grid-template-columns: repeat(3, 1fr);
      border-top: 1px solid var(--line); background: var(--bg);
    }
    .tab { padding: 12px 8px; text-align: center; color: #334155; cursor: pointer; font-weight: 600; }
    .tab.active { color: var(--brand-ink); background: #f0f9ff; }

    /* Empty state */
    .empty { padding: 18px; text-align: left; color: var(--muted); }

    /* Small helper */
    .pill { font-size: 12px; padding: 4px 8px; border-radius: 999px; background: #f1f5f9; color: #334155; border:1px solid var(--line); }

    @media (prefers-color-scheme: dark) {
      :root { --bg: #0b1020; --fg: #e8ecf3; --card: #0f1528; --line: #1f2538; --muted:#94a3b8; --brand:#22d3ee; --brand-ink:#06b6d4; }
      .btn.secondary { background: #111827; color: #e5e7eb; }
      .idea-img { background:#0b1220; }
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="back" id="backBtn" title="Back" style="visibility:hidden"></div>
    <div style="display:flex;flex-direction:column">
      <div class="brand">Giftify</div>
      <div class="muted" id="status">Not logged in</div>
    </div>
    <div style="margin-left:auto" class="pill" id="apiHost"></div>
  </header>

  <main id="screen">
    <!-- Dashboard -->
    <div id="view-dashboard">
      <div class="section-title">Dashboard</div>
      <div class="card">
        <div class="stack">
          <div class="row" style="justify-content:space-between">
            <strong>Quick account</strong>
            <span class="muted">Demo tools</span>
          </div>
          <div class="row">
            <input id="email" placeholder="demo@example.com" />
            <input id="pw" type="password" placeholder="password" />
          </div>
          <div class="row">
            <button class="btn" id="signup">Create</button>
            <button class="btn" id="login">Login</button>
            <button class="btn secondary" id="logout">Logout</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="section-title" style="margin:0 0 6px">Gift ideas</div>
        <div class="stack">
          <div class="row">
            <input id="age" type="number" placeholder="Age e.g. 9" />
            <select id="gender">
              <option value="">Gender</option>
              <option>male</option>
              <option>female</option>
              <option>unisex</option>
            </select>
            <input id="budget" type="number" placeholder="Budget NOK" />
          </div>
          <input id="notes" placeholder="Notes (e.g. lego, outdoor, coffee)" />
          <div class="row" style="justify-content:space-between">
            <span class="muted" id="budgetTip"></span>
            <button class="btn" id="viewIdeas">View ideas</button>
          </div>
        </div>
      </div>

      <div id="ideasList"></div>
      <div class="empty" id="emptyIdeas" style="display:none">No ideas matched the budget window. Try adjusting budget or notes.</div>
    </div>
  </main>

  <nav class="tabs">
    <div class="tab active" data-tab="dashboard">üè† Dashboard</div>
    <div class="tab" data-tab="create">Ôºã Create New</div>
    <div class="tab" data-tab="profile">üë§ Profile</div>
  </nav>
</div>

<script>
(() => {
  const API = location.origin;
  const $ = sel => document.querySelector(sel);
  const on = (el, ev, fn) => el && el.addEventListener(ev, fn);
  const statusEl = $('#status'), hostEl = $('#apiHost'), ideasWrap = $('#ideasList'), emptyIdeas = $('#emptyIdeas');
  hostEl.textContent = new URL(API).host;

  let token = '';
  const setStatus = (txt) => statusEl.textContent = txt;

  async function call(path, opts = {}) {
    const headers = { 'Content-Type': 'application/json' };
    if (token) headers.Authorization = 'Bearer ' + token;
    const res = await fetch(API + path, { ...opts, headers });
    const text = await res.text();
    try { return JSON.parse(text); } catch { throw new Error(text || res.statusText); }
  }

  // Auth actions
  on($('#signup'), 'click', async () => {
    const email = $('#email').value.trim() || 'demo+' + Math.random().toString(36).slice(2) + '@example.com';
    const password = $('#pw').value || 'demo1234';
    const j = await call('/auth/signup', { method:'POST', body: JSON.stringify({ fullName: 'Web User', email, password }) });
    token = j.token || ''; setStatus('Signed up'); alert('Signed up as ' + j.user?.email);
  });
  on($('#login'), 'click', async () => {
    const email = $('#email').value.trim(); const password = $('#pw').value;
    const j = await call('/auth/login', { method:'POST', body: JSON.stringify({ email, password }) });
    token = j.token || ''; setStatus('Logged in'); alert('Logged in');
  });
  on($('#logout'), 'click', () => { token = ''; setStatus('Not logged in'); });

  // Ideas
  function asInt(v) { const n = Number(v); return Number.isFinite(n) ? n : 0; }

  function renderIdeas(list) {
    ideasWrap.innerHTML = '';
    emptyIdeas.style.display = list.length ? 'none' : 'block';
    for (const it of list) {
      const price = Math.round(it.price_nok || 0);
      const merchant = it.merchant_name ? `<span class="muted">${it.merchant_name}</span>` : '';
      const desc = it.description ? `<div class="idea-desc">${it.description}</div>` : '';
      const img = it.image_url ? `<div class="idea-img"><img src="${it.image_url}" loading="lazy" alt=""></div>` : '';
      const card = document.createElement('div');
      card.className = 'card idea-card';
      card.innerHTML = `
        ${img}
        <div class="idea-title">${it.name || 'Product'}</div>
        <div class="idea-meta">
          <strong>${price ? price + ' NOK' : ''}</strong>
          ${merchant}
        </div>
        ${desc}
      `;
      ideasWrap.appendChild(card);
    }
  }

  on($('#viewIdeas'), 'click', async () => {
    const age = asInt($('#age').value);
    const gender = $('#gender').value;
    const budget = asInt($('#budget').value);
    const notes = $('#notes').value.trim();
    $('#budgetTip').textContent = budget ? `Target: ${Math.floor(budget*0.9)}‚Äì${budget} NOK` : '';

    ideasWrap.innerHTML = '';
    emptyIdeas.style.display = 'none';

    try {
      const q = new URLSearchParams({ age, gender, budget, notes }).toString();
      const j = await call('/ideas?' + q);
      renderIdeas(j.ideas || []);
    } catch (e) {
      emptyIdeas.style.display = 'block';
      emptyIdeas.textContent = 'Failed to load ideas: ' + e.message;
    }
  });

  // Tabs (placeholders for now)
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      // Keeping single-screen prototype; could swap views here.
    });
  });

})();
</script>
</body>
</html>
